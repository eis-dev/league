const router=new VueRouter({routes:[{path:"/",component:this},{path:"/:id",component:this},{path:"/:id/:league",component:this}]}),api="https://lig123.firebaseio.com/id/";var app=new Vue({router:router,el:"#app",data:{list:{},name:"",league:"",teams:[],values:{},scores:[],t_sort:[],newleague:!1,time1:!1,load:!1,updated_at:"",created_at:"",up:!1,getid:!1,onfocus:!1,changed:!1,lockable:[],locked:""},computed:{time2(){let e=[];for(let t in this.time1)e.push([this.time1[t][1],this.time1[t][0]]);return e},matches(){return[this.time1,this.time2]},safe_url(){let e=window.location.href.split("#")[0];return e=e.split("?")[0]},ifLockable(){return this.locked!==this.lockable.join("-")}},methods:{lockCtrl:function(e){return("-"+this.locked+"-").includes("-"+e+"-")},go:function(e){this.load=!1,setTimeout(function(){window.location.href=e},500)},goBack:function(){this.go(this.safe_url+"?"+this.$route.params.id+"#/"+this.$route.params.id)},goHome:function(){let e=window.location.href.split("#")[0];e=e.split("?")[0]+"?#/",this.go(e)},join:function(){this.getid&&this.getid.length>5?this.go(this.safe_url+"?"+this.getid+"#/"+this.getid):(alert("ID en az 6 karakter olmalı."),this.getId=!1)},del:function(){1==confirm(this.league[0].toUpperCase()+this.league.slice(1)+" silinsin mi?")&&axios.delete(api+this.$route.params.id+"/"+this.name+".json").then(e=>{this.goBack()})},to_string:function(e){return e?e.toString().replace(/,/g,", "):""},getScores:function(){this.changed=!0;let e=[],t=document.getElementsByClassName("match");for(let a=0;a<t.length;a++)e.push(t[a].getElementsByTagName("input")[0].value+"-"+t[a].getElementsByTagName("input")[1].value);this.scores=e},suffle:function(e){let t,a,s;for(s=e.length-1;s>0;s--)t=Math.floor(Math.random()*(s+1)),a=e[s],e[s]=e[t],e[t]=a;return e},sort:function(){let e=this,t={},a=[],s=[],l=[];for(let a in e.values.p){let s=e.values.p[a];t[s]+="-"+a,t[s]=t[s].replace("undefined-","")}for(let e in t)t[e].includes("-")&&a.push(t[e]);for(let e in a){let t=[],l=a[e].split("-");for(let e in l){for(let a in l)l[e]===l[a]||t.includes(l[a])||(s.push(l[e]+"_"+l[a]),s.push(l[a]+"_"+l[e]));t.push(l[e])}}let i=0;for(let t in s){let a=parseInt($("#"+s[t]).find(".in").val()),l=parseInt($("#"+s[t]).find(".out").val());if(a>-1&&l>-1){let n=parseInt(s[t].split("_")[0]),r=parseInt(s[t].split("_")[1]);0===i&&(e.values.vs_p[n]=0,e.values.vs_av[n]=0,e.values.vs_a[n]=0,e.values.vs_p[r]=0,e.values.vs_av[r]=0,e.values.vs_a[r]=0),a>l&&(e.values.vs_p[n]+=3),a<l&&(e.values.vs_p[r]+=3),a===l&&(e.values.vs_p[n]++,e.values.vs_p[r]++),e.values.vs_av[n]+=a-l,e.values.vs_av[r]+=l-a,e.values.vs_a[n]+=a,e.values.vs_a[r]+=l,i++}}let n=[],r=["p","vs_p","vs_av","vs_a","av","a"];for(let t in e.teams){let a="";for(let s in r){let l=r[s];a+=e.values[l][t]+500}a+="."+t,n.push(a)}n.sort().reverse();for(let e in n)l.push(n[e].split(".")[1]);e.t_sort=l},nowDate:function(){let e=new Date,t=e.getDate();t<10&&(t="0"+t);let a=e.getMonth()+1;a<10&&(a="0"+a);let s=e.getHours();s<10&&(s="0"+s);let l=e.getMinutes();return l<10&&(l="0"+l),e=t+"."+a+"."+e.getFullYear()+" - "+s+":"+l},engine:function(e){if(!e.$route.params.id&&!e.$route.params.league)return window.location.href.split("?")[1]?(e.load=!0,!1):(this.goHome(),!1);let t=[];e.$route.params.league&&axios.get(api+e.$route.params.id+"/"+e.$route.params.league+".json").then(a=>{let s=a.data;if(e.scores.toString()!==s.scores.toString()){e.league=s.league,e.teams=s.teams,e.created_at=s.created_at,e.updated_at=s.updated_at,e.locked=s.locked?s.locked:"ajans123",e.time1=s.match;for(let e=1;e<=parseInt(s.teams.length);e++)this.t_sort.push(e-1),t.push(0);setTimeout(function(){for(let e in s.scores)s.scores[e].split("-").length>1&&(document.getElementsByClassName("score-input")[2*e].value=s.scores[e].split("-")[0],document.getElementsByClassName("score-input")[2*e+1].value=s.scores[e].split("-")[1]);e.scores=s.scores},50),setTimeout(function(){e.load=!0},200),e.name=s.name,e.values.o=t,e.values.g=t,e.values.b=t,e.values.m=t,e.values.a=t,e.values.y=t,e.values.p=t,e.values.vs_p=t,e.values.vs_av=t,e.values.vs_a=t,e.values.av=t}}).catch(a=>{if("new"===e.$route.params.league){if(e.league=prompt("Ligin adı nedir?"),null===e.league)return void this.goBack();let a=prompt("Kaç takım var? Rakamla yazın, örn: 5");if(!(a>0))return void this.goBack();for(let s=1;s<=parseInt(a);s++)e.teams.push(prompt(s+". Takımın adı nedir?")),e.t_sort.push(s-1),t.push(0);let s=e.teams,l=[];for(let e in s)for(let t in s)if(e!==t){let a=0;if(l)for(let s in l)(l[s][0]===e&&l[s][1]===t||l[s][0]===t&&l[s][1]===e)&&a++;0===a&&l.push(this.suffle([e,t]))}l=e.suffle(l),new_matches=[],match_arr=[],function e(t){let a=[];for(let e in t){let l=t[e],i=!0,n=[];for(let e in l)match_arr.includes(l[e])&&(i=!1),n.push(l[e]);if(s.length-match_arr.length<2&&(match_arr.includes(n[0])&&match_arr.includes(n[1])||(i=!0),match_arr=[]),i){new_matches.push(l);for(let e in n)match_arr.push(n[e])}else a.push(l)}a.length&&e(a)}(l),l=new_matches,e.time1=l,e.load=!0,e.created_at=e.nowDate(),e.updated_at=e.created_at;let i=(new Date).getTime(),n=!1;e.scores.length&&(n=e.scores),axios.put(api+e.$route.params.id+"/"+i+".json",{name:i,league:e.league,scores:n,teams:e.teams,match:e.time1,locked:"ajans123",updated_at:e.created_at,created_at:e.created_at}).then(t=>{e.name=t.data.name,window.location.hash="#/"+e.$route.params.id+"/"+e.name}),e.values.o=t,e.values.g=t,e.values.b=t,e.values.m=t,e.values.a=t,e.values.y=t,e.values.p=t,e.values.vs_p=t,e.values.vs_av=t,e.values.vs_a=t,e.values.av=t}else this.goBack()}),e.$route.params.id&&!e.$route.params.league&&axios.get(api+e.$route.params.id+".json").then(t=>{let a=t.data,s={},l=[];for(let e in a)l.push(e);for(let e=l.length-1;e>=0;e--)s[l[e]]=a[l[e]];e.list=s,setTimeout(function(){e.load=!0},200)})},update:function(e=!1){let t=this,a=!0,s=!1;$(".score").each(function(){let e=0;$(this).find("input").each(function(){$(this).val()&&e++}),1===e&&(s=!0)}),(s||t.onfocus)&&(a=!1),(a||e)&&(t.changed||e?axios.put(api+t.$route.params.id+"/"+t.name+".json",{name:t.name,league:t.league,scores:t.scores,teams:t.teams,match:t.time1,locked:t.locked?t.locked:"ajans123",updated_at:t.nowDate(),created_at:t.created_at}).then(e=>{t.changed=!1,t.updated_at=e.data.updated_at,t.engine(t)}):t.engine(t))},lockFunc(){this.locked=this.lockable.join("-"),this.update(!0)}},watch:{scores(val){let matches=[],s=this,i=0,arr="[";for(let e in this.matches[0])matches.push(this.matches[0][e]);for(let e in this.matches[1])matches.push(this.matches[1][e]);for(let e in this.teams)arr+="0,";arr=arr.substr(0,arr.length-1),arr+="]",this.values={o:eval(arr),g:eval(arr),b:eval(arr),m:eval(arr),a:eval(arr),y:eval(arr),p:eval(arr),vs_p:eval(arr),vs_av:eval(arr),vs_a:eval(arr),av:eval(arr)};for(let e in matches)try{let t=this.teams[matches[e][0]],a=this.teams[matches[e][1]],l=document.getElementsByClassName("match")[i],n=l.getElementsByTagName("input")[0].value,r=l.getElementsByTagName("input")[1].value;n&&r&&(s.values.o[matches[e][0]]++,s.values.o[matches[e][1]]++,s.values.a[matches[e][0]]+=parseInt(n),s.values.a[matches[e][1]]+=parseInt(r),s.values.y[matches[e][0]]+=parseInt(r),s.values.y[matches[e][1]]+=parseInt(n),s.values.av[matches[e][0]]+=parseInt(n)-parseInt(r),s.values.av[matches[e][1]]+=parseInt(r)-parseInt(n),parseInt(n)>parseInt(r)&&(s.values.p[matches[e][0]]+=3,s.values.g[matches[e][0]]++,s.values.m[matches[e][1]]++),parseInt(n)<parseInt(r)&&(s.values.p[matches[e][1]]+=3,s.values.g[matches[e][1]]++,s.values.m[matches[e][0]]++),parseInt(n)===parseInt(r)&&(s.values.p[matches[e][0]]+=1,s.values.p[matches[e][1]]+=1,s.values.b[matches[e][0]]++,s.values.b[matches[e][1]]++)),i++}catch(e){}let lockable=[];$(".score").each(function(e){let t=$(this).find(".in").val(),a=$(this).find(".out").val();t&&a&&lockable.push(e)}),this.lockable=lockable,setTimeout(this.sort,100)}},mounted(){let e=this;e.engine(e),e.up=setInterval(function(){e.update()},5e3)}});